<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ë¹› - ê³µì†í•œ ë§ ë³€í™˜ê¸°</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif;
      background-color: #f9e7f0;
      margin: 0;
      padding: 20px;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(173, 125, 160, 0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    .header h1 {
      color: #ad7da0;
      margin-bottom: 8px;
      font-size: 36px;
      font-weight: 700;
    }
    .header p {
      color: #d3929b;
      margin-top: 0;
      font-size: 16px;
      font-weight: 500;
    }
    .form-group {
      margin-bottom: 24px;
    }
    label {
      display: block;
      font-size: 15px;
      font-weight: 500;
      color: #ad7da0;
      margin-bottom: 8px;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #f4dbd3;
      border-radius: 12px;
      font-size: 15px;
      background: #fff;
      transition: all 0.3s ease;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #d3929b;
      box-shadow: 0 0 0 3px rgba(211, 146, 155, 0.1);
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn {
      background: linear-gradient(135deg, #d3929b, #ad7da0);
      color: white;
      border: none;
      padding: 14px;
      border-radius: 12px;
      width: 100%;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(211, 146, 155, 0.3);
    }
    .btn:active {
      transform: translateY(0);
    }
    .result {
      margin-top: 24px;
      padding: 20px;
      background-color: #fdf6f8;
      border: 2px solid #f4dbd3;
      border-radius: 12px;
    }
    .result h3 {
      margin-top: 0;
      color: #ad7da0;
      font-size: 18px;
      font-weight: 600;
    }
    .result p {
      background-color: #fff;
      padding: 16px;
      border-radius: 10px;
      border: 1px solid #f4dbd3;
      margin: 12px 0;
    }
    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .feedback-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .feedback-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .vote-btn {
      background-color: #fff;
      border: 2px solid #f4dbd3;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      color: #ad7da0;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .vote-btn:hover {
      background-color: #fdf6f8;
      border-color: #d3929b;
    }
    .copy-btn {
      background-color: #d3929b;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .copy-btn:hover {
      background-color: #c17f88;
      transform: translateY(-1px);
    }
    .history-section {
      margin-top: 24px;
      padding: 20px;
      background-color: #fdf6f8;
      border: 2px solid #f4dbd3;
      border-radius: 12px;
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .history-header h3 {
      margin: 0;
      color: #ad7da0;
      font-size: 18px;
      font-weight: 600;
    }
    .clear-history {
      background: none;
      border: none;
      color: #d3929b;
      font-size: 14px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    .clear-history:hover {
      background-color: #f4dbd3;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: #fff;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid #f4dbd3;
    }
    .history-content {
      flex: 1;
    }
    .history-actions {
      display: flex;
      gap: 8px;
    }
    .delete-history {
      background: none;
      border: none;
      color: #f87171;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    .delete-history:hover {
      background: #fee2e2;
    }
    .premium-feature {
      background: #fdf6f8;
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
      border: 2px solid #f4dbd3;
    }
    .premium-feature-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .remaining-count {
      background: #d3929b;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
    }
    .input-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      margin-bottom: 32px;
    }
    .situation-target-group {
      display: flex;
      gap: 40px;
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    .situation-target-group > div {
      flex: 1;
    }
    .situation-target-group input {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #f4dbd3;
      border-radius: 8px;
      font-size: 14px;
      background: #fff;
      transition: all 0.3s ease;
      height: 36px;
    }
    .situation-target-group input:focus {
      outline: none;
      border-color: #d3929b;
      box-shadow: 0 0 0 3px rgba(211, 146, 155, 0.1);
    }
    .text-input-group {
      width: 100%;
      max-width: 600px;
      display: flex;
      gap: 20px;
    }
    .text-input-group > div {
      flex: 1;
    }
    .favorites-section {
      margin-top: 16px;
      padding: 16px;
      background: #fdf6f8;
      border-radius: 12px;
      border: 2px solid #f4dbd3;
    }
    .favorites-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .favorite-item {
      background: white;
      border: 1px solid #d3929b;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .favorite-item:hover {
      background: #fdf6f8;
      transform: translateY(-1px);
    }
    .favorite-delete {
      background: none;
      border: none;
      color: #d3929b;
      cursor: pointer;
      padding: 0 4px;
      font-size: 16px;
    }
    .favorite-delete:hover {
      color: #c17f88;
    }
    .save-favorite-btn {
      background: linear-gradient(135deg, #d3929b, #ad7da0);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(211, 146, 155, 0.2);
    }
    .save-favorite-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(211, 146, 155, 0.3);
    }
    .save-favorite-btn:active {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ë§ë¹›</h1>
      <p>ë‹¹ì‹ ì˜ ë§ì— ë”°ëœ»í•œ ë¹›ì„ ë”í•´ìš”</p>
    </div>
    
    <div id="transformForm">
      <div class="input-section">
        <div class="situation-target-group">
          <div style="flex: 1">
            <label>ìƒí™©/ì¥ì†Œ:</label>
            <input type="text" id="situation" value="íšŒì‚¬" placeholder="ì˜ˆ: íšŒì‚¬, í•™êµ, ë³‘ì›" required>
          </div>
          <div style="flex: 1">
            <label>ëŒ€ìƒ/ê´€ê³„:</label>
            <input type="text" id="target" value="ìƒì‚¬" placeholder="ì˜ˆ: ìƒì‚¬, êµìˆ˜ë‹˜, í™˜ì" required>
          </div>
        </div>
        
        <div style="text-align: center;">
          <button type="button" class="save-favorite-btn" id="saveFavorite">í˜„ì¬ ì¡°í•© ì¦ê²¨ì°¾ê¸° ì €ì¥</button>
        </div>

        <div class="favorites-section">
          <h4 style="margin: 0">ì €ì¥ëœ ì¡°í•©</h4>
          <div class="favorites-list" id="favoritesList">
            <!-- ì¦ê²¨ì°¾ê¸° í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <div class="text-input-group">
          <div style="flex: 1;">
            <label>ë§íˆ¬ ìŠ¤íƒ€ì¼:</label>
            <select id="toneStyle">
              <option value="polite">ê³µì†í•˜ê³  ì¹œì ˆ</option>
              <option value="business">ë¹„ì¦ˆë‹ˆìŠ¤ ê²©ì‹</option>
              <option value="rude">ì‹¸ê°€ì§€</option>
              <option value="firm" selected>ë‹¨í˜¸í•˜ì§€ë§Œ ì •ì¤‘</option>
            </select>
          </div>
          <div style="flex: 2;">
            <label>í…ìŠ¤íŠ¸:</label>
            <textarea id="inputText" placeholder="ì˜ˆ: ë‚´ì¼ê¹Œì§€ ë³´ê³ ì„œ ì¤˜" required>ë‚´ì¼ê¹Œì§€ ë³´ê³ ì„œ ì¤˜</textarea>
          </div>
        </div>
      </div>

      <div class="premium-feature">
        <div class="premium-feature-header">
          <label for="useAdvanced" style="margin: 0; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="useAdvanced" style="width: 20px; height: 20px; margin: 0;">
            <strong style="font-size: 18px; color: #ad7da0;">ê³ ê¸‰ ë³€í™˜</strong>
          </label>
          <span class="remaining-count" id="remainingCount">ë‚¨ì€ íšŸìˆ˜: 5/5</span>
        </div>
        <div style="font-size: 13px; color: #666; margin-top: 8px;">AI ê¸°ë°˜ ë§ì¶¤í˜• ë¬¸ì¥ ì—…ê·¸ë ˆì´ë“œ (ë¬´ë£Œ 5íšŒ)</div>
        
        <div style="margin-top: 16px;">
          <label>ì‘ë‹µ ê¸¸ì´:</label>
          <select id="responseLength">
            <option value="20">20ì ì´ë‚´ (ë§¤ìš° ê°„ë‹¨)</option>
            <option value="50">50ì ì´ë‚´ (ê°„ë‹¨)</option>
            <option value="100" selected>100ì ì´ë‚´ (ë³´í†µ)</option>
            <option value="200">200ì ì´ë‚´ (ìì„¸íˆ)</option>
            <option value="500">500ì ì´ë‚´ (ìƒì„¸)</option>
            <option value="1000">1000ì ì´ë‚´ (ë§¤ìš° ìƒì„¸)</option>
          </select>
        </div>
      </div>
      
      <button type="button" class="btn" id="transformButton">ì˜ˆìœ ë§ ë³€í™˜</button>
    </div>
    
    <div class="loading" style="display: none;">
      <div class="loading-spinner"></div>
      <p>ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <div class="result" style="display: none;">
      <h3>ë³€í™˜ ê²°ê³¼:</h3>
      <p>ë‚´ì¼ê¹Œì§€ ë³´ê³ ì„œ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ê¸°í•œ ë‚´ ì²˜ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.</p>
      
      <div class="actions">
        <div class="feedback-section">
          <div class="feedback-buttons">
            <button class="vote-btn">ğŸ‘ ì¢‹ì•„ìš”</button>
            <button class="vote-btn">ğŸ‘ ë³„ë¡œì˜ˆìš”</button>
          </div>
          <span style="font-size: 12px; color: #666;">
            ì‚¬ìš©ì í”¼ë“œë°±ì„ í†µí•´ ë” ë‚˜ì€ ë§ì¶¤í˜• ë³€í™˜ ì„œë¹„ìŠ¤ë¡œ ê°œì„ ë©ë‹ˆë‹¤
          </span>
        </div>
        <button class="copy-btn">ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
      </div>
    </div>
    
    <div class="history-section" style="display: none;">
      <div class="history-header">
        <h3>ìµœê·¼ ë³€í™˜ ê¸°ë¡</h3>
        <button class="clear-history" id="clearHistory">ì „ì²´ ì‚­ì œ</button>
      </div>
      <div id="historyList"></div>
    </div>
  </div>

  <script>
    // API í˜¸ì¶œ í•¨ìˆ˜
    async function callGeminiAPI(prompt) {
      try {
        console.log('API í˜¸ì¶œ ì‹œì‘:', prompt);
        const response = await fetch('https://malbit-api.vercel.app/api/gemini', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            prompt: prompt,
            maxLength: parseInt(document.getElementById('responseLength').value),
            style: document.getElementById('toneStyle').value,
            situation: document.getElementById('situation').value,
            target: document.getElementById('target').value
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error('API ì˜¤ë¥˜ ì‘ë‹µ:', errorData);
          throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status} - ${errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
        }

        const data = await response.json();
        console.log('API ì‘ë‹µ:', data);

        if (!data.result) {
          throw new Error('API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
        }

        const result = data.result.trim();
        console.log('ë³€í™˜ ê²°ê³¼:', result);
        return result;
      } catch (error) {
        console.error('API í˜¸ì¶œ ì—ëŸ¬:', error);
        throw new Error(`ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
      }
    }

    // ë³€í™˜ í•¨ìˆ˜
    async function transformSentence(text, style) {
      const situation = document.getElementById('situation').value;
      const target = document.getElementById('target').value;
      const maxLength = parseInt(document.getElementById('responseLength').value);
      
      const prompt = `ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ í•œêµ­ì–´ ë³€í™˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
      ë‹¤ìŒ ë¬¸ì¥ì„ ${style}í•œ ì–´ì¡°ë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.

      [ìš”ì²­ì‚¬í•­]
      1. ì›ë¬¸ì˜ ì˜ë¯¸ëŠ” ìœ ì§€í•˜ë©´ì„œ ë§íˆ¬ë§Œ ë³€ê²½í•´ì£¼ì„¸ìš”.
      2. ì‘ë‹µì€ ë°˜ë“œì‹œ ${maxLength}ì ì´ë‚´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
      3. ${situation}ì—ì„œ ${target}ì—ê²Œ í•˜ëŠ” ë§ì´ë¼ëŠ” ì ì„ ê³ ë ¤í•´ì£¼ì„¸ìš”.
      4. ë‹¤ìŒ ìš”ì†Œë“¤ì„ í¬í•¨í•´ì£¼ì„¸ìš”:
         - ê°„ë‹¨í•œ ì´ìœ ë‚˜ ë°°ê²½ ì„¤ëª…
         - êµ¬ì²´ì ì¸ ì‹œê°„ì´ë‚˜ ê¸°í•œ
         - í•„ìš”í•œ ê²½ìš° ì¶”ê°€ì ì¸ ìš”ì²­ì‚¬í•­
         - ê°ì‚¬ë‚˜ ë°°ë ¤ì˜ í‘œí˜„
      5. ì¡´ëŒ“ë§ê³¼ ì˜ˆì˜ë¥¼ ê°–ì¶˜ í‘œí˜„ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
      6. ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ íë¦„ì„ ìœ ì§€í•´ì£¼ì„¸ìš”.

      [ì›ë¬¸]
      "${text}"`;
      
      try {
        console.log('ë³€í™˜ ì‹œì‘:', { text, style, situation, target, maxLength });
        const transformedText = await callGeminiAPI(prompt);
        console.log('ë³€í™˜ ì™„ë£Œ:', transformedText);
        return transformedText;
      } catch (error) {
        console.error('ë³€í™˜ ì‹¤íŒ¨:', error);
        throw error;
      }
    }

    // ë§íˆ¬ ìŠ¤íƒ€ì¼ ê·œì¹™
    const styleRules = {
      polite: {
        name: 'ê³µì†í•˜ê³  ì¹œì ˆ',
        transform: (text) => {
          return text.replace(/ì¤˜$/g, 'ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤')
                    .replace(/í•´$/g, 'í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤')
                    .replace(/^(.*)(í•´|ì¤˜|ì¢€|ìš”ì²­|ë¶€íƒ)$/g, 'í˜¹ì‹œ $1í•´ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?');
        }
      },
      business: {
        name: 'ë¹„ì¦ˆë‹ˆìŠ¤ ê²©ì‹',
        transform: (text) => {
          return text.replace(/ì¤˜$/g, 'ì „ë‹¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤')
                    .replace(/í•´$/g, 'ì§„í–‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤')
                    .replace(/^(.*)(í•´|ì¤˜|ì¢€|ìš”ì²­|ë¶€íƒ)$/g, '$1 ê²€í†  í›„ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤');
        }
      },
      rude: {
        name: 'ì‹¸ê°€ì§€',
        transform: (text) => {
          return text.replace(/ì¤˜$/g, 'ì¤˜ë´, ì–¼ë§ˆë‚˜ ê±¸ë¦¬ëŠ”ë°?')
                    .replace(/í•´$/g, 'í•´ë´, ë­ê°€ ê·¸ë¦¬ ì–´ë ¤ì›Œ?')
                    .replace(/^(.*)(í•´|ì¤˜|ì¢€|ìš”ì²­|ë¶€íƒ)$/g, '$1 ë‹¹ì—°íˆ í•´ì•¼ ë˜ëŠ” ê±° ì•„ë‹˜?');
        }
      },
      firm: {
        name: 'ë‹¨í˜¸í•˜ì§€ë§Œ ì •ì¤‘',
        transform: (text) => {
          return text.replace(/ì¤˜$/g, 'ì „ë‹¬ ë°”ëë‹ˆë‹¤')
                    .replace(/í•´$/g, 'ì§„í–‰í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤')
                    .replace(/^(.*)(í•´|ì¤˜|ì¢€|ìš”ì²­|ë¶€íƒ)$/g, '$1 ë°˜ë“œì‹œ í•„ìš”í•œ ì‚¬í•­ì´ì˜¤ë‹ˆ í˜‘ì¡° ë¶€íƒë“œë¦½ë‹ˆë‹¤');
        }
      }
    };

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
      
      // ë‚¨ì€ íšŸìˆ˜ ì´ˆê¸°í™”
      let premiumUsageCount = 5;
      const remainingCount = document.getElementById('remainingCount');
      if (remainingCount) {
        remainingCount.textContent = `ë‚¨ì€ íšŸìˆ˜: ${premiumUsageCount}/5`;
      }

      // ì¦ê²¨ì°¾ê¸° ëª©ë¡ ë¡œë“œ
      function loadFavorites() {
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const favoritesList = document.getElementById('favoritesList');
        favoritesList.innerHTML = '';
        
        favorites.forEach((favorite, index) => {
          const favoriteItem = document.createElement('div');
          favoriteItem.className = 'favorite-item';
          
          const content = document.createElement('span');
          content.textContent = `${favorite.situation} - ${favorite.target}`;
          content.onclick = function() {
            document.getElementById('situation').value = favorite.situation;
            document.getElementById('target').value = favorite.target;
          };
          
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'favorite-delete';
          deleteBtn.textContent = 'Ã—';
          deleteBtn.onclick = function(e) {
            e.stopPropagation();
            favorites.splice(index, 1);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            loadFavorites();
          };
          
          favoriteItem.appendChild(content);
          favoriteItem.appendChild(deleteBtn);
          favoritesList.appendChild(favoriteItem);
        });
      }

      // ì´ˆê¸° ì¦ê²¨ì°¾ê¸° ë¡œë“œ
      loadFavorites();

      // ì¦ê²¨ì°¾ê¸° ì €ì¥
      const saveFavorite = document.getElementById('saveFavorite');
      if (saveFavorite) {
        saveFavorite.addEventListener('click', function() {
          const situation = document.getElementById('situation').value.trim();
          const target = document.getElementById('target').value.trim();
          
          if (situation && target) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const isDuplicate = favorites.some(f => 
              f.situation === situation && f.target === target
            );
            
            if (!isDuplicate) {
              favorites.push({ situation, target });
              localStorage.setItem('favorites', JSON.stringify(favorites));
              loadFavorites();
              alert('ì¦ê²¨ì°¾ê¸°ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
              alert('ì´ë¯¸ ì €ì¥ëœ ì¡°í•©ì…ë‹ˆë‹¤.');
            }
          } else {
            alert('ìƒí™©ê³¼ ëŒ€ìƒì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          }
        });
      }

      // ê³ ê¸‰ ë³€í™˜ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
      const useAdvanced = document.getElementById('useAdvanced');
      if (useAdvanced) {
        useAdvanced.addEventListener('change', function() {
          if (this.checked && premiumUsageCount <= 0) {
            alert('ë¬´ë£Œ ì‚¬ìš© íšŸìˆ˜ë¥¼ ëª¨ë‘ ì†Œì§„í•˜ì…¨ìŠµë‹ˆë‹¤.');
            this.checked = false;
          }
        });
      }

      // ë³€í™˜ ë²„íŠ¼
      const transformButton = document.getElementById('transformButton');
      if (transformButton) {
        transformButton.addEventListener('click', async function() {
          console.log('ë³€í™˜ ë²„íŠ¼ í´ë¦­ë¨');
          const inputText = document.getElementById('inputText').value.trim();
          const selectedStyle = document.getElementById('toneStyle').value;
          const useAdvanced = document.getElementById('useAdvanced');
          
          if (!inputText) {
            alert('ë³€í™˜í•  ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
          }

          document.querySelector('.loading').style.display = 'block';
          document.querySelector('.result').style.display = 'none';
          document.querySelector('.history-section').style.display = 'none';

          try {
            let transformedText;
            if (useAdvanced && useAdvanced.checked) {
              console.log('AI ë³€í™˜ ì‚¬ìš©');
              if (premiumUsageCount <= 0) {
                alert('ë¬´ë£Œ ì‚¬ìš© íšŸìˆ˜ë¥¼ ëª¨ë‘ ì†Œì§„í•˜ì…¨ìŠµë‹ˆë‹¤.');
                document.querySelector('.loading').style.display = 'none';
                return;
              }
              
              // AI ë³€í™˜ ì‹¤í–‰
              transformedText = await transformSentence(inputText, selectedStyle);
              console.log('AI ë³€í™˜ ê²°ê³¼:', transformedText);
              
              // íšŸìˆ˜ ì°¨ê°
              premiumUsageCount--;
              remainingCount.textContent = `ë‚¨ì€ íšŸìˆ˜: ${premiumUsageCount}/5`;
            } else {
              console.log('ê¸°ë³¸ ë³€í™˜ ì‚¬ìš©');
              transformedText = styleRules[selectedStyle].transform(inputText);
              console.log('ê¸°ë³¸ ë³€í™˜ ê²°ê³¼:', transformedText);
            }

            setTimeout(() => {
              document.querySelector('.loading').style.display = 'none';
              document.querySelector('.result').style.display = 'block';
              document.querySelector('.history-section').style.display = 'block';

              document.querySelector('.result p').textContent = transformedText;
              addToHistory(inputText, transformedText, selectedStyle);
            }, 1500);
          } catch (error) {
            console.error('ë³€í™˜ ì¤‘ ì˜¤ë¥˜:', error);
            document.querySelector('.loading').style.display = 'none';
            alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          }
        });
      }

      // ë³µì‚¬ ë²„íŠ¼
      const copyBtn = document.querySelector('.copy-btn');
      if (copyBtn) {
        copyBtn.addEventListener('click', async function() {
          const resultText = document.querySelector('.result p').textContent;
          try {
            await navigator.clipboard.writeText(resultText);
            alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } catch (err) {
            alert('ë³µì‚¬í•˜ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        });
      }

      // í”¼ë“œë°± ë²„íŠ¼
      document.querySelectorAll('.vote-btn').forEach(button => {
        button.addEventListener('click', function() {
          const isLike = this.textContent.includes('ì¢‹ì•„ìš”');
          alert(isLike ? 'ì¢‹ì•„ìš” ê°ì‚¬í•©ë‹ˆë‹¤!' : 'í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤.');
        });
      });

      // ê¸°ë¡ ì‚­ì œ
      const clearHistoryBtn = document.getElementById('clearHistory');
      if (clearHistoryBtn) {
        clearHistoryBtn.addEventListener('click', function() {
          const historyList = document.getElementById('historyList');
          historyList.innerHTML = '';
          document.querySelector('.history-section').style.display = 'none';
        });
      }
    });

    // ê¸°ë¡ ì¶”ê°€ í•¨ìˆ˜
    function addToHistory(originalText, transformedText, style) {
      const historyList = document.getElementById('historyList');
      const historyItem = document.createElement('div');
      historyItem.className = 'history-item';
      
      historyItem.innerHTML = `
        <div class="history-content">
          <div><strong>ì›ë¬¸:</strong> ${originalText}</div>
          <div><strong>ë³€í™˜:</strong> ${transformedText}</div>
          <div style="color: #666; font-size: 12px;">ìŠ¤íƒ€ì¼: ${styleRules[style].name}</div>
        </div>
        <div class="history-actions">
          <button class="delete-history">ì‚­ì œ</button>
        </div>
      `;
      
      historyItem.querySelector('.delete-history').addEventListener('click', function() {
        historyList.removeChild(historyItem);
        if (historyList.children.length === 0) {
          document.querySelector('.history-section').style.display = 'none';
        }
      });
      
      if (historyList.children.length >= 5) {
        historyList.removeChild(historyList.lastChild);
      }
      
      historyList.insertBefore(historyItem, historyList.firstChild);
    }
  </script>
</body>
</html>